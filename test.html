<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body
    style="background-image: url('imgs/board.jpg'); background-repeat: no-repeat; background-attachment: fixed; background-size: 100% 100%;">
    <div style="margin-top: 20%; color: azure;">
        <button id="pickCard" onclick="addscore()"> 카드 뽑기</button>
        <button id="getResult" onclick="getResult()"> 결과 보기(이판 종료)</button>
        <button id="gameover" onclick="gameover(true)">게임 계속진행</button>
        <button id="gameover" onclick="gameover(false)">게임 초기화</button>
    </div>

    <div id="dealerCard">
    </div>
    <div id="card">
    </div>
    <script>
        let playermoney = 0;
        let detector = true;
        let dealerscore = 0;
        let playerscore = 0;
        let filelist = [
            { "filename": "2C.png", "score": "2" }, { "filename": "3C.png", "score": "3" }, { "filename": "4C.png", "score": "4" }, { "filename": "5C.png", "score": "5" }, { "filename": "6C.png", "score": "6" },
            { "filename": "7C.png", "score": "7" }, { "filename": "8C.png", "score": "8" }, { "filename": "9C.png", "score": "9" }, { "filename": "10C.png", "score": "10" }, { "filename": "AC.png", "score": "1" },
            { "filename": "KC.png", "score": "10" }, { "filename": "QC.png", "score": "10" }, { "filename": "JC.png", "score": "10" },
            { "filename": "2D.png", "score": "2" }, { "filename": "3D.png", "score": "3" }, { "filename": "4D.png", "score": "4" }, { "filename": "5D.png", "score": "5" }, { "filename": "6D.png", "score": "6" },
            { "filename": "7D.png", "score": "7" }, { "filename": "8D.png", "score": "8" }, { "filename": "9D.png", "score": "9" }, { "filename": "10D.png", "score": "10" }, { "filename": "AD.png", "score": "1" },
            { "filename": "KD.png", "score": "10" }, { "filename": "QD.png", "score": "10" }, { "filename": "JD.png", "score": "10" },
            { "filename": "2H.png", "score": "2" }, { "filename": "3H.png", "score": "3" }, { "filename": "4H.png", "score": "4" }, { "filename": "5H.png", "score": "5" }, { "filename": "6H.png", "score": "6" },
            { "filename": "7H.png", "score": "7" }, { "filename": "8H.png", "score": "8" }, { "filename": "9H.png", "score": "9" }, { "filename": "10H.png", "score": "10" }, { "filename": "AH.png", "score": "1" },
            { "filename": "KH.png", "score": "10" }, { "filename": "QH.png", "score": "10" }, { "filename": "JH.png", "score": "10" },
            { "filename": "2S.png", "score": "2" }, { "filename": "3S.png", "score": "3" }, { "filename": "4S.png", "score": "4" }, { "filename": "5S.png", "score": "5" }, { "filename": "6S.png", "score": "6" },
            { "filename": "7S.png", "score": "7" }, { "filename": "8S.png", "score": "8" }, { "filename": "9S.png", "score": "9" }, { "filename": "10S.png", "score": "10" }, { "filename": "AS.png", "score": "1" },
            { "filename": "KS.png", "score": "10" }, { "filename": "QS.png", "score": "10" }, { "filename": "JS.png", "score": "10" }
        ];





        //-----------------------------------------카드 뽑기-----------------------------------------
        var tempCardList = filelist.map((v) => { return v; });

        function dealerPickCard() {
            let dealerCardIndex = parseInt(Math.random() * tempCardList.length);
            let dealerCardName = tempCardList[dealerCardIndex];
            tempCardList.splice(dealerCardIndex, 1);
            console.log("dealer : ", dealerCardName.filename);
            document.getElementById("dealerCard").innerHTML += '<img src=52_cards/' + dealerCardName.filename + ' alt="" style="float: right; width: 10%">';
            return dealerCardName.score
        }

        function playerPickCard() {
            let cardIndex = parseInt(Math.random() * tempCardList.length);
            let cardName = tempCardList[cardIndex];
            tempCardList.splice(cardIndex, 1);
            console.log("player : ", cardName.filename);
            document.getElementById("card").innerHTML += '<img src=52_cards/' + cardName.filename + ' alt="" style="float: left; width: 10%">';

            return cardName.score
        }

        function pickCard() {
            if (detector) {
                return { "userScore": playerPickCard(), "dealerScore": dealerPickCard() };
            }
        }



        //-----------------------------------------게임 오버-----------------------------------------
        //document.getElementById("gameover").addEventListener("click",gameover);
        function gameover(bool) {
            document.getElementById("card").innerHTML = "";
            document.getElementById("dealerCard").innerHTML = "";
            document.getElementById("result").innerHTML = "";
            if (!bool) {
                playermoney = 0;
                tempCardList = filelist.map((v) => { return v; });
            }
            playerscore = 0;
            dealerscore = 0;
            detector = true;
        }

        //-----------------------------------------score 합치기-----------------------------------------
        function addscore() {
            let oneTime = pickCard();
            dealerscore += parseInt(oneTime.dealerScore);
            playerscore += parseInt(oneTime.userScore);

            if (dealerscore > 21 && playerscore > 21) {
                console.log(dealerscore);
                busted("무승부! 둘다 파산");
            } else if (dealerscore > 21 && playerscore <= 21) {
                busted("유저 승리! 딜러 파산");
            } else if (dealerscore <= 21 && playerscore > 21) {
                busted("딜러 승리! 유저 파산");
            }
        }

        //-----------------------------------------어느 한쪽이라도 버스티드면 이리로 보냄-----------------------------------------
        function busted(result) {

            document.getElementById("result").innerText += result;
            detector = false;
        }

        //-----------------------------------------결과 계산-----------------------------------------
        function getResult() {
            if (detector) {
                document.getElementById("result").innerHTML = " 딜러 : " + dealerscore;
                document.getElementById("result").innerHTML += " 플레이어 : " + playerscore + "<br>";

                if (dealerscore < 17) {
                    dealerscore += parseInt(dealerPickCard());
                    if (dealerscore > 21 && playerscore <= 21) {
                        busted("유저 승리! 딜러 파산");
                    }
                }



                if (dealerscore > playerscore) {
                    document.getElementById("result").innerText += " 딜러 승리 ";
                } else if (playerscore > dealerscore) {
                    document.getElementById("result").innerText += " 유저 승리 ";
                } else {
                    document.getElementById("result").innerText += " 무승부 ";
                }
                detector = false;
            }
        }
    </script>

    <body onload="doPopupopen();">
        ...
    </body>

    <script type="text/javascript">
        function doPopupopen() {
            window.open("sh.html", "popup01", "width=450, height=700");
        }
    </script>
</body>
<div id="result" style="margin-top: 50%; color: azure;">
</div>

</html>

<!-- 1. 점수가 다 안차면 딜러 카드 더 뽑기
      2. 딜러 사진은 안보이는걸로
    3. 종합점수 계산(승수 쌓인거라던지) -->